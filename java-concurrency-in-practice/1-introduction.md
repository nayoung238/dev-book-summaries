## 개요

OS 개념이 생기면서 multiprogramming 가능
- 이전에는 하나의 프로그램만 실행 가능
- OS 개념이 생기면서 여러 프로세스를 메모리에 올려 실행 가능
- CPU, 메모리 가상화를 제공해 여러 프로세스가 동시에 실행하는 착각 제공

OS 개념을 개발하게 된 요인
- 자원 활용: I/O 작업에 CPU 사용하지 않음, 이때 다른 프로세스에게 넘겨주면 효율적 (CPU 사용률 올릴 수 있음)
- 공정성: 여러 사용자와 프로그램이 컴퓨터 내 자원에 대해 동일한 권한을 가져야 함 (SRT, RR, MLFQ)
- 편의성: 한 작업을 최대한 분리 (한 동작에 많은 책임을 부여하지 않는다)

### 스레드 이점

현대 운영체제의 대부분은 커널 스레드를 CPU 자원의 스케줄링 단위로 사용한다.
- 일대일 관계, 다대다 관계 모두 커널 스레드가 스케줄링 단위

멀티스레드 프로그램에선 특정 스레드가 I/O 발생해도 다른 스레드를 계속 실행해 CPU 사용률을 높일 수 있음
- 프로세서가 2개인 시스템에서 스레드가 하나뿐인 프로그램을 실행하면 CPU 자원을 50% 낭비하는 것

### 단순한 비동기 이벤트 처리

각 요청을 별개 스레드에서 처리하면 특정 스레드가 대기 상태가 되어도 다른 스레드는 영향받지 않고 계속 처리 가능하다.
이는 요청이 많아질수록 스레드가 많이 필요하지만, 다음과 같은 방법으로 해결한다.
- select나 poll 시스템 콜처럼 효율적인 다중화 I/O 수단 개발 (multiplexing)
- Tomcat BIO -> NIO 방식으로 전환

***

### 스레드 사용의 위험성

동기화를 충분히 하지 않으면 여러 스레드에서 실행되는 연산 순서 예측 불가능
- atomic 패키지가 아닌 기본 int 변수에 여러 스레드가 ++ 연산을 총 1000번 해도 그 결과가 정확히 1000 이라는 보장 없음
- 즉, 멀티 스레드 환경에서 동기화에 실패하면 예상하지 못한 값 생성
- CAS 연산, synchronized, 락 같은 기술을 사용해 동기화를 설정해야 함

### 성능 위험
스레드를 많이 사용하는 것이 좋다고 말할 수 없음
- 스레드 많으면 컨텍스트 스위칭 빈번하게 발생 (메모리 읽고 쓰는 지역성 손실, CPU 스케줄링 발생)
- 데이터 공유 시 동기화 수단 필요 (동기화 코드로 인해 병렬성 감소할 수 있음)